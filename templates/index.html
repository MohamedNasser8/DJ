<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div id="chartContainer" style="height: 360px; width: 100%"></div>
    <br />
    <button id="submitStartButton" type="submit" value="Start">
      Start Live Chart
    </button>
    <button id="submitStopButton" type="submit" value="Stop">
      Stop Live Chart
    </button>
    <button id="submitBackButton" type="submit" value="Back">
      back Live Chart
    </button>
    <form method="POST" enctype="multipart/form-data">
      {{form.hidden_tag()}} {{form.file()}} {{form.submit()}}
    </form>
    <button type="button" class="btn btn-primary" id="togle_spec">
      show spectogram
    </button>
    <img
      id="picture"
      style="height: 400px; width: 800px"
      src="data:image/jpeg;base64,{{ img_data }}"
    />
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script>
      //dataPoints.
           var dps = [];
           var dps1=[];
           const a=5
           x={{t | tojson}};
           y={{y | tojson}};
           y2={{y2|tojson}};
           for (let i=0; i <1000; i++) {
            dps.push({
               x:x[i],
               y:y[i]
             });
             dps1.push({
              x:x[i],
              y:y2[i]
            });
           }
           var chart = new CanvasJS.Chart("chartContainer", {
            animationEnabled: true,
            zoomEnabled: true,
             title: {
               text: "Live Data",
             },
             axisX: {
               title: "Axis X Title",
             },
             axisY: {
               title: "Units",
             },
             data: [
               {
                 type: "line",
                 dataPoints: dps  ,
               },
               {
                type: "line",
                dataPoints:dps1,
               }
             ],
           });

           chart.render();

           // Updating the Chart
           var xVal = dps1.length + 1;
           var yVal = 20;
           var updateInterval =1;
           let length = 1000;

           var updateChart = function () {
             dps.push({ x:x[xVal], y: y[2*xVal] });
             dps1.push({ x:x[xVal],y:y2[xVal]});
             xVal++;
             if (dps1.length > length)
             {
              dps.shift()
              dps1.shift()
            };
             chart.render();
           };

           var updateChart_backward = function () {
            if (xVal>length)
                {
                    dps.pop();
                    dps1.pop();
                    dps.unshift({ x:x[(xVal-length-1)], y: y[2*(xVal-length-1)] });
             dps1.unshift({ x:x[xVal],y:y2[(xVal-length-1)]});
                    xVal--;
                }
             chart.render();
           }

           var timeoutId,
             startButton = document.getElementById("submitStartButton"),
             stopButton = document.getElementById("submitStopButton");
            backButton=document.getElementById("submitBackButton")
            togle=document.getElementById("togle_spec")
            img=document.getElementById("picture")
            function startLiveChart() {
                stopLiveChart()
                timeoutId = setInterval(function () {
               updateChart();
             }, updateInterval);

             startButton.removeEventListener("click", startLiveChart);
             stopButton.addEventListener("click", stopLiveChart);
             backButton.addEventListener("click",back);
           }
           function back(){
            stopLiveChart()
              timeoutId = setInterval(function () {
               updateChart_backward();
             }, updateInterval);
             backButton.removeEventListener("click", back);
             startButton.addEventListener("click", startLiveChart);
             stopButton.addEventListener("click", stopLiveChart);
           }

           function stopLiveChart() {
             clearTimeout(timeoutId);
             stopButton.removeEventListener("click", stopLiveChart);
             startButton.addEventListener("click", startLiveChart);
             backButton.addEventListener("click",back);
           }
           function dis()
           {
         if( img.style.display != "none")
            img.style.display = "none";
           else{
            img.style.display="block"
           }
           }




           startButton.addEventListener("click", startLiveChart);
           togle.addEventListener("click",dis)
    </script>
  </body>
</html>
